
# User Story: Mapping Changes for New PFD Fields

## Story Title
Implement mapping changes for new PFD fields to staging tables

## Story ID
SDS-XXX

## Epic Link
[Data Ingestion Improvements]

## Description
As a data engineer, I need to update the mapping between the analysis_pfd source system and our SDS staging tables to accommodate new fields and mapping changes, so that we can ensure all relevant data is properly loaded into our data model.

## Background
The current mapping between analysis_pfd and our staging tables needs to be updated to support new fields and changed mappings. This work is part of our ongoing efforts to improve data completeness and quality in the Supplier Data Service.

## Acceptance Criteria
1. Update the mapping configuration to include all new PFD fields
2. Ensure existing mappings that are changing are correctly updated
3. Handle any unmapped fields appropriately (either map to new targets or mark as not required)
4. Update data loading processes to accommodate the new mapping
5. Test the updated mapping with sample data to ensure proper data loading
6. Document all mapping changes for reference

## Technical Details
- The changes will affect the following staging tables:
  - sds_staging.business_entity
  - sds_staging.business_entity_details
  - sds_staging.business_entity_characteristics 
  - sds_staging.business_entity_identifiers
  - sds_staging.physical_address
  - sds_staging.telecommunication_address
  - sds_staging.electronic_address
  - sds_staging.business_entity_spend_analysis
  - sds_staging.business_entity_payment_profile_attribute
  - sds_staging.restrictions
  - sds_staging.business_entity_industry_classification
  - sds_staging.business_entity_card_association
  - sds_staging.business_entity_card_revenues

- Current mapping configuration is stored in [location/repository/file]
- Source system schema definitions are available in [location/repository/file]
- Target schema definitions are defined in our DDL scripts

## Dependencies
- Access to the latest version of the analysis_pfd data structure
- Confirmation of all new fields that need to be mapped
- Testing environment with sample data

## Effort Estimation
Story Points: [5]

## Definition of Done
- Mapping configuration is updated
- Data loading processes successfully use the new mapping
- All tests pass with sample data
- Documentation is updated
- Code review is completed and approved
- Changes are merged to the appropriate branch



# Jira Subtasks for "Mapping Changes for New PFD Fields"

## Subtask 1: Analysis of New PFD Fields

**Title:** Analyze New PFD Fields and Determine Mapping Requirements

**Description:**
Review the updated analysis_pfd source system documentation to identify all new fields and changes to existing fields. Document the data types, formats, and business meaning of each field.

**Acceptance Criteria:**
- Complete inventory of all new PFD fields documented
- Data types and formats identified for each new field
- Existing fields with mapping changes identified
- Initial mapping recommendations documented

**Effort Estimate:** 1 SP

---

## Subtask 2: Target Schema Review

**Title:** Review Target Schema and Identify Required Changes

**Description:**
Review the existing staging table structures to determine if they can accommodate all new fields. Identify any schema changes needed in the staging tables.

**Acceptance Criteria:**
- Appropriate target tables and columns identified for all new fields
- Any required schema changes documented
- DDL scripts prepared for any new columns needed

**Effort Estimate:** 1 SP

---

## Subtask 3: Update Mapping Configuration

**Title:** Update Mapping Configuration File with New Field Mappings

**Description:**
Update the mapping configuration file to include all new field mappings and changes to existing mappings. Include any required transformations or constants.

**Acceptance Criteria:**
- Mapping file updated with all new mappings
- Changes to existing mappings implemented
- Mapping file validated for syntax and correctness
- "No mapping" fields properly handled

**Effort Estimate:** 2 SP

---

## Subtask 4: Update ETL Processes

**Title:** Modify ETL Processes to Support New Mappings

**Description:**
Update the data loading processes to accommodate the new field mappings. Implement any required data transformations and update error handling.

**Acceptance Criteria:**
- ETL processes modified to handle new mappings
- Data transformation logic implemented where needed
- Error handling updated for new fields
- Process changes tested with sample data

**Effort Estimate:** 2 SP

---

## Subtask 5: Testing and Validation

**Title:** Test and Validate New Mapping Implementation

**Description:**
Conduct thorough testing of the updated mapping and ETL processes using sample data. Verify that all fields are correctly mapped and loaded.

**Acceptance Criteria:**
- Unit tests completed for individual field mappings
- Integration tests completed for the end-to-end process
- Regression tests performed to ensure existing functionality works
- All test results documented

**Effort Estimate:** 1 SP

---

## Subtask 6: Documentation and Knowledge Transfer

**Title:** Update Documentation and Conduct Knowledge Transfer

**Description:**
Update all relevant documentation with the new mapping details. Create or update operational guidelines and conduct knowledge transfer sessions as needed.

**Acceptance Criteria:**
- Mapping documentation updated
- Operational guidelines updated
- Knowledge transfer sessions completed
- All changes documented in the appropriate repositories

**Effort Estimate:** 1 SP

---

## Subtask 7: Deployment Planning and Execution

**Title:** Plan and Execute Deployment of Mapping Changes

**Description:**
Create a deployment plan for the mapping changes, including rollback procedures. Execute the deployment in the production environment.

**Acceptance Criteria:**
- Deployment scripts created
- Rollback procedures established
- Changes deployed to production
- Initial data loads monitored and verified
- Any issues addressed promptly

**Effort Estimate:** 1 SP

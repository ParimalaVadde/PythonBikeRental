registered_agents sample values 
[]
['CASSIE WHITLOCK']
['C T CORPORATION SYSTEM', 'CT CORPORATION SYSTEM', 'THE CORPORATION TRUST INCORPORATED']

registered_agents_schema = ArrayType(StringType())

# Convert JSON string to actual array
transformed_json_df = transformed_json_df.withColumn(
    "registered_agents",
    when(
        (col("registered_agents_json").isNotNull()) & 
        (col("registered_agents_json") != "[]") & 
        (col("registered_agents_json") != ""),
        from_json(col("registered_agents_json"), ArrayType(StringType()))
    ).otherwise(lit(None))
)

# Convert array to semicolon-separated string
transformed_json_df = transformed_json_df.withColumn(
    "registered_agents",
    when(
        (col("registered_agents").isNotNull()) & (size(col("registered_agents")) > 0),
        concat_ws(";", col("registered_agents"))
    ).otherwise(lit(""))
)

# Step 1: Convert string representation of list to actual array
transformed_json_df = transformed_json_df.withColumn(
    "registered_agents",
    when(
        (col("registered_agents").isNotNull()) & 
        (col("registered_agents") != "[]") & 
        (col("registered_agents") != ""),
        from_json(col("registered_agents"), ArrayType(StringType()))
    ).otherwise(lit(None))
)

# Step 2: Convert array to semicolon-separated string
transformed_json_df = transformed_json_df.withColumn(
    "registered_agents",
    when(
        (col("registered_agents").isNotNull()) & (size(col("registered_agents")) > 0),
        concat_ws(";", col("registered_agents"))
    ).otherwise(lit(""))
)


Error Category: QUERY_ERROR; Failed Line Number: 864; AnalysisException: Union can only be performed on tables with the compatible column types. The third column of the second table is string type which is not compatible with array<string> at same column of first table;


Error Category: INVALID_ARGUMENT_ERROR; Failed Line Number: 875; NameError: name 'size' is not defined


CASSIE WHITLOCK;INCORP SERVICES INC;JESSICA BJORLING;TODD GRIERSON
C T CORPORATION SYSTEM;CT CORPORATION SYSTEM;THE CORPORATION TRUST INCORPORATED


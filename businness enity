earlier design flow

earlier client was uploading source files to s3 (it can be either 1 file upload or multiple files upload

so we had event bridge which trigers step func(event bridge was scheduled based which was schedule to trigger 2 times a day)

during schld time. watever files present in s3
in step function we will first have ecs task . which will read the files from s3 (be it be 1 file or more than one file, all at once
it will read all those files at once load all these files data to landing schema at one go

basically this ecs task will drop table in landing schema (table name analysis_pdf) based on files columns it create table again analysis_pfd and load the data



then later now landing schema (analysis_pfd) will have entire 5 files data

now we will staging glue job which will read entire data from landing and perform certain transformation and load data to 16 different tables in staging schema 


later we have main glue job trigger in step function which will perform depuplication and trust matrix operation load data in main schema for 16 tables

ok



now there is a change in design flow

there is no more source file upload to s3

client will upload file/ files to ui
API(ecs fargate) will read the data from ui and load data to landing schma (in analysis_ut with 2 extra columns file_name_with_timestamp, another columns in uuid perfil
these 2 column values will be same per file

so now ecs fargate will load data to landing now we have data in landing , with per file differentiation so 

now have to load data from landing to staging to main

should be performed this process file by file 

like suppose if we have 5 files data in landing 

then from landing to stg to main need to load file by file

sin case if it failes in stg or main

we will capture the job status in meta table

so and so file failed be it be staging or main

meta table will have 2 cols , one is file_name another is job status

how can it be designed

how to schld step function file by file using event brige and sqs or any other better services in aws

-- First, make sure the pgcrypto extension is enabled
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- Then modify your query
SELECT 
  t1.*, 
  CAST(digest(CONCAT_WS('-', 
    COALESCE(t1.vendor_name_cleaned, ''), 
    COALESCE(CAST(t1.vendor_id AS VARCHAR), ''), 
    COALESCE(CAST(t1.vendor_government_id AS VARCHAR), '')
  ), 'sha256') AS VARCHAR) AS stg_business_entity_id 
FROM (
  -- Rest of your query remains the same
  select distinct 
    'PFD' as source_system_name, 
    cast(vendor_name_cleaned as VARCHAR) as vendor_name_cleaned,
    cast(vendor_id as VARCHAR) as vendor_id,
    cast(vendor_government_id as VARCHAR) as vendor_government_id,
    cast(NULL as VARCHAR) as source_system_id, 
    cast(NULL as VARCHAR) as parent_id, 
    cast(1 as Decimal(23,3)) as hierarchy_level, 
    cast(1 as Decimal(23,3)) as hierarchy_identifier, 
    cast(1 as Decimal(23,3)) as hierarchy_role, 
    cast('Y' as VARCHAR) as is_active, 
    current_timestamp as created_date, 
    cast('supplier_directory' as VARCHAR) as created_by 
  from sds_landing.analysis_pfd
) t1


\xdfdf394a69a558ba0e8fbd3f26c8f2e66b7b9ef75ae6bc89e6d8309eb0605022
f5c5f707-82e5-c68c-ddd7-34a03ddf7af7

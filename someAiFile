


associated_people
sample data
[{'name': 'CHRIS LEWIS', 'titles': ['DIRECTOR', 'CHIEF FINANCIAL OFFICER', 'CHIEF EXECUTIVE OFFICER']}, {'name': 'NOAH DYE', 'titles': ['DIRECTOR', 'SECRETARY', 'OFFICER']}, {'name': 'BRIAN MUNDEN', 'titles': ['TREASURER', 'FINANCIAL CONTROLLER']}, {'name': 'STEPHEN CORSI', 'titles': ['MANAGER', 'SECRETARY']}, {'name': 'CHRISTOPHER LEWIS', 'titles': ['CFO']}, {'name': 'MORGAN MCCINTIC', 'titles': ['CHIEF EXECUTIVE OFFICER']}]


if emty list or null or empty values should ignored


associated_people__name , associated_people__titles
CHRIS LEWIS,DIRECTOR
CHRIS LEWIS,CHIEF FINANCIAL OFFICER
CHRIS LEWIS,CHIEF EXECUTIVE OFFICER
NOAH DYE, DIRECTOR
NOAH DYE, SECRETARY
NOAH DYE, OFFICER

simillarly for rest 

need to integrate associated_people too 


relavalent configs in staging_schema.py for flatten json

jsoncol = ["stg_business_entity_id", "registered_agents", "associated_people", "industries", "technologies", "card_revenue", "card_transactions_stability"]

# Updated schemas based on your sample data
# For card_revenue - this appears to be a single object, not an array
card_revenue_schema = StructType([
    StructField("end_date", StringType(), True),
    StructField("date_accessible", StringType(), True),  # MISSING FIELD ADDED
    StructField("1m", StructType([
        StructField("start_date", StringType(), True),
        StructField("average_monthly_amount", DoubleType(), True)
    ]), True),
    StructField("3m", StructType([
        StructField("start_date", StringType(), True),
        StructField("average_monthly_amount", DoubleType(), True)
    ]), True),
    StructField("12m", StructType([
        StructField("start_date", StringType(), True),
        StructField("average_monthly_amount", DoubleType(), True)
    ]), True)
])

# For card_transactions_stability - single object
card_transactions_stability_schema = StructType([
    StructField("end_date", StringType(), True),
    StructField("date_accessible", StringType(), True),
    StructField("1m", StructType([
        StructField("start_date", StringType(), True),
        StructField("days_present", IntegerType(), True),
        StructField("weeks_present", IntegerType(), True),
        StructField("months_present", IntegerType(), True),
        StructField("daily_coverage_ratio", DoubleType(), True),
        StructField("weekly_coverage_ratio", DoubleType(), True),
        StructField("monthly_coverage_ratio", DoubleType(), True)
    ]), True),
    StructField("3m", StructType([
        StructField("start_date", StringType(), True),
        StructField("days_present", IntegerType(), True),
        StructField("weeks_present", IntegerType(), True),
        StructField("months_present", IntegerType(), True),
        StructField("daily_coverage_ratio", DoubleType(), True),
        StructField("weekly_coverage_ratio", DoubleType(), True),
        StructField("monthly_coverage_ratio", DoubleType(), True)
    ]), True),
    StructField("12m", StructType([
        StructField("start_date", StringType(), True),
        StructField("days_present", IntegerType(), True),
        StructField("weeks_present", IntegerType(), True),
        StructField("months_present", IntegerType(), True),
        StructField("daily_coverage_ratio", DoubleType(), True),
        StructField("weekly_coverage_ratio", DoubleType(), True),
        StructField("monthly_coverage_ratio", DoubleType(), True)
    ]), True)
])

# For associated_people - this is an array
associated_people_schema = ArrayType(StructType([
    StructField("name", StringType(), True),
    StructField("titles", ArrayType(StringType()), True)
]))

# For industries - this appears to be a single object based on sample
industries_schema = StructType([
    StructField("classification_type", StringType(), True),
    StructField("classification_code", StringType(), True),
    StructField("classification_description", StringType(), True)
])

# For technologies - this appears to be a single object based on sample  
technologies_schema = StructType([
    StructField("vendor_name", StringType(), True),
    StructField("category", StringType(), True)
])

company_structure_schema = ArrayType(StructType([
                StructField("corporate_structures", StringType(), True)
            ]))
            
associated_tax_ids_schema = ArrayType(StringType())
registered_agents_schema = ArrayType(StringType())


# Configuration mapping
JSON_FIELD_CONFIGS = {
    'card_revenue': {
        'schema': card_revenue_schema,
        'flatten_type': 'struct',  # Single nested object
        'prefix': 'card_revenue'
    },
    'card_transactions_stability': {
        'schema': card_transactions_stability_schema,
        'flatten_type': 'struct',  # Single nested object
        'prefix': 'card_transactions_stability'
    },
    'associated_people': {
        'schema': associated_people_schema,
        'flatten_type': 'array_double_explode',  # Array with nested array (titles)
        'prefix': 'associated_people'
    },
    'industries': {
        'schema': industries_schema,
        'flatten_type': 'struct',  # Single nested object
        'prefix': 'industries'
    },
    'technologies': {
        'schema': technologies_schema,
        'flatten_type': 'struct',  # Single nested object
        'prefix': 'technologies'
    }
}

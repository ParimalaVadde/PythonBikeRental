INSERT INTO sds_staging.business_entity (
    stg_business_entity_id,
    source_system_id,
    source_system_name,
    hierarchy_identifier,
    hierarchy_level,
    hierarchy_role,
    parent_id,
    is_active,
    last_updated_by,
    last_updated_date,
    created_by,
    created_date
)
WITH t1 AS (
  SELECT DISTINCT 
    'PFD' AS source_system_name, 
    CAST(vendor_name_cleaned AS VARCHAR) AS vendor_name_cleaned,
    CAST(vendor_email AS VARCHAR) AS vendor_email,
    CAST(vendor_government_id AS VARCHAR) AS vendor_government_id,
	CAST(vendor_address_ln_1 AS VARCHAR) AS vendor_address_ln_1,
    CAST(NULL AS VARCHAR) AS source_system_id, 
    CAST(NULL AS VARCHAR) AS parent_id, 
    CAST('1' AS VARCHAR) AS hierarchy_level, 
    CAST('1' AS VARCHAR) AS hierarchy_identifier, 
    CAST('1' AS VARCHAR) AS hierarchy_role, 
    CAST('Y' AS BOOLEAN) AS is_active,
    CAST(current_timestamp AS TIMESTAMP) AS created_date, 
    CAST('supplier_directory' AS VARCHAR) AS created_by 
  FROM sds_landing.analysis_pfd
),
hash_values AS (
  SELECT 
    t1.*,
    encode(digest(CONCAT_WS('-', 
      COALESCE(t1.vendor_name_cleaned, ''), 
      COALESCE(t1.vendor_email, ''), 
      COALESCE(t1.vendor_government_id, ''),
	  COALESCE(t1.vendor_address_ln_1, '')
    ), 'sha256'), 'hex') AS hash_value
  FROM t1
)
SELECT 
  substring(hash_value, 1, 8) || '-' ||
  substring(hash_value, 9, 4) || '-' ||
  substring(hash_value, 13, 4) || '-' ||
  substring(hash_value, 17, 4) || '-' ||
  substring(hash_value, 21, 12) AS stg_business_entity_id,
  h.source_system_id,
  h.source_system_name,
  h.hierarchy_identifier,
  h.hierarchy_level,
  h.hierarchy_role,
  h.parent_id,
  h.is_active,
  NULL AS last_updated_by,
  NULL AS last_updated_date,
  h.created_by,
  h.created_date
FROM hash_values h;

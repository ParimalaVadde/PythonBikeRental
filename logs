import builtins  # add at top of utils.py

row_count = df.count()
optimal_partitions = builtins.max(4, builtins.min(20, row_count // 1000))
df_optimized = df.repartition(optimal_partitions)
